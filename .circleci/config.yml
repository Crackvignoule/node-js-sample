version: 2.1

jobs:
  say-hello:
    docker:
      - image: cimg/base:current
    steps:
      - checkout
      - run:
          name: "Say hello"
          command: "echo Hello, World!"

  build-docker:
    docker:
      - image: docker:stable
    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.7
      - run:
          name: Build Docker image
          command: |
            docker build -t node-js-sample .
      - run:
          name: Save Docker image
          command: |
            docker save node-js-sample | gzip > node-js-sample.tar.gz
      - persist_to_workspace:
          root: .
          paths:
            - node-js-sample.tar.gz

workflows:
  say-hello-workflow:
    jobs:
      - say-hello
      - build-docker